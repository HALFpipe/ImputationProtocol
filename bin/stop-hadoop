#!/usr/bin/env bash

verbose=1

run_cmd() {
    cmd="$*"

    printf '%s\n' --------------------

    if [ "${verbose}" = "1" ]; then
	printf "$cmd\n"
    fi

    eval "$@"

    exit_code=$?

    if [[ ${exit_code} -gt 0 ]]; then
	echo "ERROR: command exited with nonzero status ${exit_code}"
    fi

    printf '%s\n' --------------------

    return ${exit_code}
}

export HADOOP_PID_DIR=/data/hadoop/pids

for pid_file in ${HADOOP_PID_DIR}/hadoop-*.pid; do
    run_cmd "kill \$(cat ${pid_file})"
    run_cmd rm pid_file
done
